TARGET=$1
ARCH=$2
SMP=$3
CC=$4

# Generate a temporary compile.h

( echo \#define UTS_MACHINE \"$ARCH\"

  echo -n \#define UTS_VERSION \"\#`cat .version`
  if [ -n "$SMP" ] ; then echo -n " SMP"; fi
  echo ' '`date`'"'

  echo \#define LINUX_COMPILE_TIME \"`date +%T`\"
  echo \#define LINUX_COMPILE_BY \"`whoami`\"
  echo \#define LINUX_COMPILE_HOST \"`hostname`\"

  if [ -x /bin/dnsdomainname ]; then
    echo \#define LINUX_COMPILE_DOMAIN \"`dnsdomainname`\"
  elif [ -x /bin/domainname ]; then
    echo \#define LINUX_COMPILE_DOMAIN \"`domainname`\"
  else
    echo \#define LINUX_COMPILE_DOMAIN
  fi

  echo \#define LINUX_COMPILER \"`$CC -v 2>&1 | tail -1`\"
) > .tmpcompile

mv -f .tmpcompile $TARGET
